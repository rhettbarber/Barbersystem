

    <style type="text/css">
        .accordion-heading a.accordion-toggle { display: inline-block; }
        .container {margin:0px;padding:0px;}
    </style>

    <%=  fields_for "purchase[purchases_entry_attributes][]" , purchases_entry do |p|  %>
        <%  if purchases_entry.opposite_entry == false  %>


            <% item =  Item.find(purchases_entry.item_id)  %>
            <% quantity = purchases_entry.QuantityOnOrder %>




            <div class="panel panel-default">
              <div class="panel-heading">

                <div class="container" style="float:left;display:inline-block;width:100%;">
                  <%= p.hidden_field :id  ,:index => nil%>
                  <%= p.text_field :QuantityOnOrder ,:index => nil ,:size => 2 , :value => number_with_precision(purchases_entry.QuantityOnOrder, :precision => 0 )   %>
                  <b><%= item.ItemLookupCode %> <%= item.dimensions %> </b>
                  <%= item.description_before_color_and_size %><br>
                </div>
                <br>




                <div class="container" style="float:left;display:inline-block;margin:0px;padding:0px;">
                  <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#pe_<%= purchases_entry.id  %>">
                    <% if purchases_entry.master_department_id != 0 %>
                        <%=   image_tag purchases_entry.item.image_url( purchases_entry.master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
                    <% else %>
                        <%=   image_tag purchases_entry.item.image_url( purchases_entry.item.default_master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
                    <% end %>
                    <%   link_to(image_tag( 'item_thumbnails/' + purchases_entry.item.PictureName ,:size => "100x100",  :border => 0), { :controller => 'cart', :action => "enlarge_cart_image",		:item => purchases_entry.item_id  }, :popup => ['new_window_name', 'height=400,width=400'])  %>
                  </a>
                </div>

                <div class="purchases_entry_links" style="width:170px;float:right;">
                  <%=  link_to( "Delete",  { :action => "delete_symbiont_purchases_entry",:purchases_entry_id => purchases_entry.id  } , :class => "btn btn-default"  , data: { confirm: "Are you sure you want to delete this item?" } ) %><br><br>
                  <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#pe_<%= purchases_entry.id  %>"> <button type="button" class="btn btn-default">Details </button></a>
                </div>




                <% if item.department_is_permanent_or_volume_discountable == true %>
                    <%= link_to image_tag('/images/buttons/dollar-sign.png',:size => "30x30", :border => 0 ), {:controller => 'cart', :action => 'show_discount_info' } , :popup => ['new_window_name', 'height=400,width=800']  %>
                <% end %>



              </div>


              <%= render(:partial => "purchases_entries/purchases_entry_wholesale_accordion",:locals => { :purchases_entry => purchases_entry })%>
              <%#  if purchases_entry.complete_symbiont  %>
              <b>  <div class="container text-right" style="background-color: black;color:white;float:left;display:inline-block;width:100%;padding:10px;"> Extended Price: <%=  number_to_currency( purchases_entry.your_extended_price(@customer,quantity,item))  %> </div>   </b>
              <%#  end  %>
            </div>

        <% else %>


            <% wholesale_should_not_have_master %>


        <% end %>
    <% end %>




















 <% if @wholesale_has_master %>

    <% if purchases_entry.master_entry == true %>

        <% ss = "ss" %>

        <%=  fields_for "purchase[purchases_entry_attributes][]" , purchases_entry do |p|  %>

            <% if purchases_entry.item_id  == 0 or  purchases_entry.item_id  == '0'  %>
            <% else %>
                <% item =  Item.find(purchases_entry.item_id)  %>
                <% quantity = purchases_entry.QuantityOnOrder %>
                <%   purchases_entry_complete_symbiont =   purchases_entry.complete_symbiont %>

                <div class="panel panel-default">
                  <div class="panel-heading">

                    <div class="container" style="float:left;display:inline-block">
                      <%= p.hidden_field :id  ,:index => nil%>
                      <%= p.text_field :QuantityOnOrder ,:index => nil ,:size => 2 , :value => number_with_precision(purchases_entry.QuantityOnOrder,:precision => 0 )   %>
                      <b><%= item.ItemLookupCode %> <%= item.dimensions %> </b>
                      <%= item.description_before_color_and_size %><br>
                      <% if  purchases_entry_complete_symbiont %>
                          <b>Design: <%= purchases_entry.opposite_entry.ItemLookupCode  %></b> <%= purchases_entry.opposite_entry.Description  %>
                      <% end %>
                    </div>
                    <br>

                    <div class="container" style="float:left;display:inline-block;margin:0px;padding:0px;">
                      <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href='#pe_<%= purchases_entry.id  %>' style="float:left;">

                        <% if purchases_entry.master_department_id != 0 %>
                            <%=   image_tag purchases_entry.item.image_url( purchases_entry.master_department_id , 'item_thumbnails/','x'  ),:size => '70x70'  %>
                        <% else %>
                            <%=   image_tag purchases_entry.item.image_url( purchases_entry.item.default_master_department_id , 'item_thumbnails/','x'  ),:size => '70x70'  %>
                        <% end %>
                        <%  if purchases_entry.opposite_entry != '0'  %>
                            <%  if purchases_entry.opposite_entry.item %>
                                <%=   image_tag( '/images/item_thumbnails/' + purchases_entry.opposite_entry.item.PictureName ,:size => "95x95",  :border => 0   )   %>
                            <% end %>
                        <%  end  %>
                      </a>
                    </div>


                    <div class="purchases_entry_links" style="width:170px;float:right;">
                      <% if purchases_entry.on_hold == 1 %>
                          <% if @sss %>
                              <br><br>
                              <div class="container text-center" style="font-size:14px;font-weight:bolder;color:red;">This item is on hold     </div>  <br>
                          <% end %>

                          <%= link_to "Complete Combination",{:controller => "cart",  :action => "complete_this_combination", :purchases_entry_id => purchases_entry.id }  , :class => "btn btn-danger"   %>

                      <% elsif  !purchases_entry_complete_symbiont %>
                          <%#= link_to image_tag('/images/buttons/complete_this_combination.gif', :border => 0), :action => "complete_this_combination", :purchases_entry_id => purchases_entry.id  %>
                          <%= link_to  "Choose Design" , { :controller => 'browse'}, :class => "btn btn-danger"   %><br><br>
                      <% end %>



                      <%=  link_to( "Delete",  { :action => "delete_symbiont_purchases_entry",:purchases_entry_id => purchases_entry.id  } , :class => "btn btn-default"  , data: { confirm: "Are you sure you want to delete this item?" } ) %><br><br>
                      <% if  purchases_entry_complete_symbiont %>
                          <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href='#pe_<%= purchases_entry.id  %>'>  <button type="button" class="btn btn-default">Details </button> </a>
                      <% end %>
                    </div>



                  </div>


                  <div id="pe_<%= purchases_entry.id  %>" class="panel-collapse collapse" style="height: 0px;">
                    <div class="panel-body details-panel">
                      <div   style="text-align: center;float:left;width: 100%;">
                        <%  if purchases_entry.complete_symbiont  %>
                            Unit Price: <%= number_to_currency(purchases_entry.symbiont_full_unit_price)   %>
                        <%  end  %>

                        <% if  purchases_entry_complete_symbiont %>
                            <% design_item = Item.find purchases_entry.opposite_entry.item_id %>
                            <%= render :partial => "purchases_entries/purchases_entry_recommend",:locals => {:item => design_item } %><br><br>
                            <%= link_to "View Combination", {  :controller  => "specsheet", :purchases_entry_id => purchases_entry.id  }   , :class => "btn btn-primary"  unless controller.controller_name == 'purchases' %>
                        <% end %>
                      </div>


                    </div>
                  </div>

                  <%#  if purchases_entry.complete_symbiont  %>
                  <b>  <div class="container text-right" style="background-color: black;color:white;float:left;display:inline-block;width:100%;padding:10px;"> Extended Price:<%=  number_to_currency(purchases_entry.symbiont_full_extended_price)  %> </div>   </b>
                  <%#  end  %>

                </div>





            <%  end  %>

        <%  end  %>


    <%  end  %>
    <% end %>









































<% if @almost_before %>

    <style type="text/css">
        .accordion-heading a.accordion-toggle { display: inline-block; }
    </style>


    <%  if purchases_entry.opposite_entry == false  %>
        <% ss %>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#pe_<%= purchases_entry.id  %>">
                <% item =  Item.find(purchases_entry.item_id)  %>
                <% quantity = purchases_entry.QuantityOnOrder %>
                <% if purchases_entry.master_department_id != 0 %>
                    <%=   image_tag purchases_entry.item.image_url( purchases_entry.master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
                <% else %>
                    <%=   image_tag purchases_entry.item.image_url( purchases_entry.item.default_master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
                <% end %>
                <%   link_to(image_tag( 'item_thumbnails/' + purchases_entry.item.PictureName ,:size => "100x100",  :border => 0), { :controller => 'cart', :action => "enlarge_cart_image",		:item => purchases_entry.item_id  }, :popup => ['new_window_name', 'height=400,width=400'])  %>

                <%= item.ItemLookupCode %>
                <% if item.department_is_permanent_or_volume_discountable == true %>
                    <%= link_to image_tag('/images/buttons/dollar-sign.png',:size => "30x30", :border => 0 ), {:controller => 'cart', :action => 'show_discount_info' } , :popup => ['new_window_name', 'height=400,width=800']  %>
                <% end %>
                <%= item.Description %>
                <%=  number_to_currency(   purchases_entry.your_extended_price(@customer,quantity,item))  %>
              </a>
            </h4>
          </div>


          <div id="pe_<%= purchases_entry.id  %>" class="panel-collapse collapse" style="height: 0px;">
            <div class="panel-body">
              <%= render(:partial => "purchases_entries/purchases_entry_wholesale_accordion",:locals => { :purchases_entry => purchases_entry })%>
            </div>
          </div>
        </div>

    <% else %>

        <% if purchases_entry.master_entry == true %>

            <% ss = "ss" %>

            <%=  fields_for "purchase[purchases_entry_attributes][]" , purchases_entry do |p|  %>

                <% if purchases_entry.item_id  == 0 or  purchases_entry.item_id  == '0'  %>
                <% else %>
                    <% item =  Item.find(purchases_entry.item_id)  %>
                    <% quantity = purchases_entry.QuantityOnOrder %>
                    <%   purchases_entry_complete_symbiont =   purchases_entry.complete_symbiont %>

                    <div class="panel panel-default">
                      <div class="panel-heading">

                        <% unless controller.controller_name == 'purchases'  %>
                            <%= p.hidden_field :id  ,:index => nil%>
                            <%= p.text_field :QuantityOnOrder ,:index => nil ,:size => 2 , :value => number_with_precision(purchases_entry.QuantityOnOrder,:precision => 0 )   %>
                        <%  else  %>
                            <%=  quantity   %>
                        <%  end  %>

                        <h4 class="panel-title">
                          <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#pe_<%= purchases_entry.id  %>" style="font-size: 14px;'>



                                  <b><%= item.ItemLookupCode %> <%= item.dimensions %> </b>




                                  <%= item.description_before_color_and_size %><br>





                                  <% if  purchases_entry_complete_symbiont %>
                                  <b>Design: <%= purchases_entry.opposite_entry.ItemLookupCode  %></b> <%= purchases_entry.opposite_entry.Description  %><br />
                                  <% end %>



                                  <% if purchases_entry.master_department_id != 0 %>
                                  <%=   image_tag purchases_entry.item.image_url( purchases_entry.master_department_id , 'item_thumbnails/','x'  ),:size => '70x70'  %>
                                  <% else %>
                                  <%=   image_tag purchases_entry.item.image_url( purchases_entry.item.default_master_department_id , 'item_thumbnails/','x'  ),:size => '70x70'  %>
                                  <% end %>


                                  <%  if purchases_entry.opposite_entry != '0'  %>
                                  <%  if purchases_entry.opposite_entry.item %>
                                  <%=   image_tag( '/images/item_thumbnails/' + purchases_entry.opposite_entry.item.PictureName ,:size => "95x95",  :border => 0   )   %>
                                  <% end %>
                                  <%  end  %>

                                  <br>




                                  <%# this is not operational   link_to(image_tag( 'item_thumbnails/' + purchases_entry.item.PictureName ,:size => "100x100",  :border => 0), { :controller => 'cart', :action => "enlarge_cart_image",		:item => purchases_entry.item_id  }, :popup => ['new_window_name', 'height=400,width=400'])  %>


                                  <% if item.department_is_permanent_or_volume_discountable == true %>
                                  <%= link_to image_tag('/images/buttons/dollar-sign.png',:size => "30x30", :border => 0 ), {:controller => 'cart', :action => 'show_discount_info' } , :popup => ['new_window_name', 'height=400,width=800']  %>
                                  <% end %>
                                  <%#= item.Description %>
                                  <% if  purchases_entry_complete_symbiont %>
                                  <button type="button" class="btn btn-default">Details </button>
                          <% end %>

                          </a>

                          <% if purchases_entry.on_hold == 1 %>
                          <br><br>
                          <div class="container text-center" style="font-size:14px;font-weight:bolder;color:red;">This item is on hold     </div>  <br>
                          <%= link_to "Complete Combination",{:controller => "cart",  :action => "complete_this_combination", :purchases_entry_id => purchases_entry.id }  , :class => "btn btn-danger"   %> <br><br>
                          <% elsif  !purchases_entry_complete_symbiont %>
                          <%#= link_to image_tag('/images/buttons/complete_this_combination.gif', :border => 0), :action => "complete_this_combination", :purchases_entry_id => purchases_entry.id  %>
                          <%= link_to  "Choose Design" , { :controller => 'browse'}, :class => "btn btn-danger"   %><br><br>
                          <% end %>


                          <%=  link_to( "Delete",  { :action => "delete_symbiont_purchases_entry",:purchases_entry_id => purchases_entry.id  } , :class => "btn btn-default"  , data: { confirm: "Are you sure you want to delete this item?" }  ) unless controller.controller_name == 'purchases'  %>


                          </h4>
                      </div>


                      <div id="pe_<%= purchases_entry.id  %>" class="panel-collapse collapse" style="height: 0px;">
                        <div class="panel-body details-panel">
                          <div  id="full_unit_price_<%= purchases_entry.id %>" style="text-align: right;">
                            <%  if purchases_entry.complete_symbiont  %>
                                Unit Price: <%= number_to_currency(purchases_entry.symbiont_full_unit_price)   %>
                            <%  end  %>
                          </div>

                          <% if  purchases_entry_complete_symbiont %>
                              <% design_item = Item.find purchases_entry.opposite_entry.item_id %>
                              <%= render :partial => "purchases_entries/purchases_entry_recommend",:locals => {:item => design_item } %><br><br>
                              <%= link_to "View Combination", {  :controller  => "specsheet", :purchases_entry_id => purchases_entry.id  }   , :class => "btn btn-primary"  unless controller.controller_name == 'purchases' %>
                          <% end %>


                        </div>
                      </div>

                      <b> <%  if purchases_entry.complete_symbiont  %>
                            <div class="container text-right" style="background-color: black;color:white;"> Extended Price:<%=  number_to_currency(purchases_entry.symbiont_full_extended_price)  %> </div>
                        <%  end  %>
                      </b>

                    </div>





                <%  end  %>

            <%  end  %>


        <%  end  %>


    <% end %>


<% end %>





























<% if @before %>

<%=  fields_for "purchase[purchases_entry_attributes][]" , purchases_entry do |p|  %>

    <% if purchases_entry.item_id  == 0  %>
        <tr id="<%= 'purchases_entry_' + purchases_entry.id.to_s %>">
          <td class="purchases_entry_delete" id="delete">
          </td>
          <td  class="purchases_entry_image" id="image">
          </td>

          <td  class="purchases_entry_quantity" id="quantity">

          </td>

          <td  class="purchases_entry_itemlookupcode" id="itemlookupcode"></td>

          <td  class="purchases_entry_description" id="description">
            <h3>  Complete this item by choosing a
              <% if @purchase %>
                  <% if @purchase.symbiote_type == 'master' %>
                      <%= link_to "Design", :controller => 'browse' %>
                  <% else %>
                      <%= link_to "Garment", :controller => 'browse' %>
                  <% end %>
              <% else %>

              <% end %>
            </h3>
          </td>

          <td  class="purchases_entry_full_unit_price" id="full_unit_price">
            <div  id="full_unit_price_<%= purchases_entry.id %>">

            </div>
          </td>

          <td  class="purchases_entry_full_extended_price" id="full_extended_price">
            <div  id="full_extended_price_<%= purchases_entry.id %>">

            </div>
          </td>

          <td  class="purchases_entry_your_extended_price_savings" id="your_extended_price_savings">
            <div  id="your_extended_price_savings_<%= purchases_entry.id %>">

            </div>
          </td>

          <td  class="purchases_entry_your_extended_price" id="your_extended_price">
            <div  id="your_extended_price_<%= purchases_entry.id %>">

            </div>
          </td>

        </tr>
    <% else %>
        <% item =  Item.find(purchases_entry.item_id)  %>
        <% quantity = purchases_entry.QuantityOnOrder %>

        <tr id="<%= 'purchases_entry_' + purchases_entry.id.to_s %>">
          <td class="purchases_entry_delete" id="delete">
            <%=  link_to(image_tag("/images/buttons/delete.gif",:border => 0), {:controller => 'cart', :action =>"delete_purchases_entry",:purchases_entry_id => purchases_entry.id} ) %>
          </td>
          <td  class="purchases_entry_image" id="image">
            <% if purchases_entry.master_department_id != 0 %>
                <%=   image_tag purchases_entry.item.image_url( purchases_entry.master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
            <% else %>
                <%=   image_tag purchases_entry.item.image_url( purchases_entry.item.default_master_department_id , 'item_thumbnails/','x'  ),:size => '80x80'  %>
            <% end %>
            <%   link_to(image_tag( 'item_thumbnails/' + purchases_entry.item.PictureName ,:size => "100x100",  :border => 0), { :controller => 'cart', :action => "enlarge_cart_image",		:item => purchases_entry.item_id  }, :popup => ['new_window_name', 'height=400,width=400'])  %>
          </td>

          <td  class="purchases_entry_quantity" id="quantity">
            <% unless controller.controller_name == 'purchases'  %>
                <%= p.hidden_field :id  ,:index => nil%>
                <%= p.text_field :QuantityOnOrder ,:index => nil ,:size => 2 , :value => number_with_precision(purchases_entry.QuantityOnOrder, :precision => 0 )   %>
            <%  else  %>
                <%=  quantity   %>
            <%  end  %>
          </td>

          <td  class="purchases_entry_itemlookupcode" id="itemlookupcode">

            <%= item.ItemLookupCode %>
            <% if item.department_is_permanent_or_volume_discountable == true %>
                <%= link_to image_tag('/images/buttons/dollar-sign.png',:size => "30x30", :border => 0 ), {:controller => 'cart', :action => 'show_discount_info' } , :popup => ['new_window_name', 'height=400,width=800']  %>
            <% end %>

          </td>

          <td  class="purchases_entry_description" id="description">






            Description:<%= item.Description %>	<br />

            <%= 'Dimensions:' if item.dimensions != '' %> <%= item.dimensions %><br />

            <%= link_to image_tag('/images/buttons/view_details_short.png', :border => 0), :controller => "specsheet", :purchases_entry_id => purchases_entry.id  unless controller.controller_name == 'purchases' %>







          </td>

          <td  class="purchases_entry_full_unit_price" id="full_unit_price">
            <div  id="full_unit_price_<%= purchases_entry.id %>">
              <%=  number_to_currency(item.full_unit_price(@customer))  %>
            </div>
          </td>

          <td  class="purchases_entry_unit_quantity_tier_discount_price" id="unit_quantity_tier_discount_price">
            <div id="unit_quantity_tier_discount_price_<%= purchases_entry.id %>">
              <%= number_to_currency(  item.unit_quantity_tier_discount_price(@customer, quantity))   %>
            </div>
          </td>




          <td  class="purchases_entry_full_extended_price" id="full_extended_price">
            <div  id="full_extended_price_<%= purchases_entry.id %>">
              <%=    number_to_currency(  purchases_entry.full_extended_price(@customer,item))  %>
            </div>
          </td>

          <td  class="purchases_entry_your_extended_price_savings" id="your_extended_price_savings">
            <div  id="your_extended_price_savings_<%= purchases_entry.id %>">
              <%=  number_to_currency(   purchases_entry.your_extended_price_savings(@customer,quantity,item))   %>
            </div>
          </td>

          <td  class="purchases_entry_your_extended_price" id="your_extended_price">
            <div  id="your_extended_price_<%= purchases_entry.id %>">
              <strong>   <%=  number_to_currency(   purchases_entry.your_extended_price(@customer,quantity,item))  %>  </strong>
            </div>
          </td>

        </tr>
    <%  end  %>


<% end %>


 <% end %>


